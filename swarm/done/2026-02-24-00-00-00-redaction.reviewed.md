# Task: Redaction — Selective Obstacle Erasure

## Overview

Implement the **Redaction** ability and its test page (`/test/redaction`). This is the second of four editing abilities (Phase 2, step 10). While Margin Stitch creates passages between walls, Redaction **erases obstacles entirely** — spikes, barriers, hazard zones, and blocking platforms are temporarily removed from the world.

The metaphor: the player is literally redacting text from the living manuscript. They black out a dangerous passage, and the hazard disappears. Like all editing abilities, Redaction has **zero flow interruption** — the player activates it without stopping movement.

**IMPORTANT: This task depends on Margin Stitch being complete.** Margin Stitch establishes the exclusion zone pattern in TileMap's `resolveCollisions()`. Redaction uses the same exclusion zone system but for a different purpose — erasing entire platforms rather than creating passages between them.

## What to Build

### 1. Obstacle Types (`src/engine/physics/Obstacles.ts`)

Before Redaction can erase obstacles, the engine needs the concept of "obstacle" as distinct from "platform." Platforms are solid ground/walls; obstacles are hazards that hurt or block the player but can be redacted.

```typescript
export type ObstacleType = 'spikes' | 'barrier' | 'laser' | 'hazard_zone';

export interface Obstacle {
  /** Unique ID for tracking redaction state */
  id: string;
  /** World-space bounding box */
  rect: Rect;
  /** Type of obstacle — affects visuals and behavior */
  type: ObstacleType;
  /** Whether this obstacle is currently active (not redacted) */
  active: boolean;
  /** Damage dealt on contact (0 = blocking only, no damage) */
  damage: number;
  /** Whether the player can collide with this obstacle (solid barriers) */
  solid: boolean;
  /** Visual color when active */
  color: string;
  /** Visual color when redacted (ghost of former self) */
  redactedColor: string;
}
```

**Obstacle behaviors:**
- **Spikes**: Not solid (player passes through), but deal damage on overlap. When redacted, they become inert.
- **Barrier**: Solid and blocking (like a platform but redactable). When redacted, collision is removed entirely — player passes through.
- **Laser**: Thin horizontal/vertical beam, not solid, deals damage on overlap. When redacted, beam disappears.
- **Hazard zone**: A rectangular area that deals damage over time while the player overlaps. When redacted, becomes inert.

For the test page, **spikes** and **barriers** are the priority. Lasers and hazard zones can be visually simpler placeholders.

### 2. Redaction System (`src/engine/abilities/Redaction.ts`)

The Redaction ability works in two modes:

**Mode 1 — Targeted Redaction (primary):**
The player aims in a direction (based on held directional input or facing direction). The system highlights the nearest redactable obstacle in that direction within range. Pressing the ability key redacts it.

**Mode 2 — Area Redaction (stretch goal / simplified for now):**
Skip this for now — targeted is sufficient. Area redaction would erase all obstacles within a radius.

**Core data structures:**

```typescript
export interface RedactionTarget {
  /** The obstacle being targeted */
  obstacle: Obstacle;
  /** Distance from player center to obstacle center */
  distance: number;
  /** Whether this obstacle is in the player's aim direction */
  inAimDirection: boolean;
}

export interface ActiveRedaction {
  /** The obstacle being redacted */
  obstacle: Obstacle;
  /** Remaining duration in seconds */
  remainingTime: number;
  /** Total duration for visual fade calculation */
  totalDuration: number;
  /** The "redaction mark" visual — expands outward during activation */
  visualProgress: number; // 0 = just activated, 1 = fully redacted
}

export interface RedactionParams {
  /** Maximum distance to detect redactable obstacles (px) */
  maxRedactionRange: number;
  /** Duration the obstacle stays redacted (seconds) */
  redactionDuration: number;
  /** Cooldown after a redaction expires before another can be placed (seconds) */
  redactionCooldown: number;
  /** Maximum number of simultaneously active redactions */
  maxActiveRedactions: number;
  /** Speed of the "redaction mark" visual expanding (0-1 per second) */
  redactionVisualSpeed: number;
  /** Aim cone half-angle in radians — how wide the targeting cone is */
  aimConeHalfAngle: number;
  /** Whether the ability is unlocked/available */
  enabled: boolean;
}

export const DEFAULT_REDACTION_PARAMS: RedactionParams = {
  maxRedactionRange: 200,       // ~8 player widths — generous for targeting
  redactionDuration: 5.0,       // 5 seconds — longer than stitch (4s) since player needs to traverse
  redactionCooldown: 3.0,       // 3 seconds — slightly longer cooldown to prevent spam-clearing rooms
  maxActiveRedactions: 2,       // Can redact 2 obstacles at once — creates interesting timing puzzles
  redactionVisualSpeed: 6.0,    // Fully "blacked out" in ~0.17 seconds — fast but visible
  aimConeHalfAngle: Math.PI / 4, // 45° half-angle (90° total cone) — generous aim
  enabled: true,
};
```

**Redaction class:**

```typescript
export class Redaction {
  params: RedactionParams;

  /** All detected obstacles in range */
  detectedObstacles: RedactionTarget[] = [];

  /** The currently highlighted (best) target — null if none in range */
  targetedObstacle: RedactionTarget | null = null;

  /** Currently active redactions */
  activeRedactions: ActiveRedaction[] = [];

  /** Cooldown timer (seconds remaining) */
  cooldownTimer: number = 0;

  /** Whether the ability can be activated right now */
  get canActivate(): boolean;

  /**
   * Scan for redactable obstacles near the player.
   * Uses player position and facing/aim direction to rank targets.
   * Call every frame.
   */
  scanForTargets(
    playerCenter: Vec2,
    aimDirection: Vec2,  // normalized direction based on input or facing
    obstacles: Obstacle[]
  ): void;

  /**
   * Activate redaction on the targeted obstacle.
   * Returns true if activation succeeded.
   */
  activate(tileMap: TileMap): boolean;

  /**
   * Update timers (active redaction durations, cooldown, visual progress).
   * Handles restoring obstacles when redaction expires.
   * Call every physics frame.
   */
  update(dt: number, tileMap: TileMap): void;

  /**
   * Render redaction visuals: targeting highlights, active redaction marks, timers.
   * Call during render.
   */
  render(renderer: Renderer, camera: Camera): void;
}
```

### 3. Aim Direction System

The player aims in the direction of held directional input. If no directional input is held, the aim defaults to the player's facing direction.

```typescript
function getAimDirection(input: InputManager, facingRight: boolean): Vec2 {
  let dx = 0, dy = 0;
  if (input.isHeld(InputAction.Left)) dx -= 1;
  if (input.isHeld(InputAction.Right)) dx += 1;
  if (input.isHeld(InputAction.Up)) dy -= 1;
  if (input.isHeld(InputAction.Down)) dy += 1;

  if (dx === 0 && dy === 0) {
    // Default to facing direction (horizontal)
    dx = facingRight ? 1 : -1;
  }

  // Normalize
  const len = Math.sqrt(dx * dx + dy * dy);
  return { x: dx / len, y: dy / len };
}
```

Target selection uses a cone check: the angle between the aim direction and the vector from the player to the obstacle must be within `aimConeHalfAngle`. Among obstacles in the cone, prefer the nearest.

### 4. Obstacle-TileMap Integration

Solid obstacles (barriers) need to participate in collision. There are two approaches:

**Approach A (Recommended):** Each solid obstacle has a corresponding `Platform` in the TileMap. When the obstacle is redacted, add an exclusion zone for that platform (using the same system Margin Stitch established). When the redaction expires, remove the exclusion zone.

**Approach B:** Track obstacles separately from TileMap platforms and run a second collision pass. This is more complex.

Go with Approach A. The test page will:
1. Create `Platform` entries in the TileMap for solid obstacles (barriers)
2. Also create corresponding `Obstacle` entries with `solid: true`
3. Store a mapping: `Map<string, Platform>` linking obstacle IDs to their TileMap platforms
4. When an obstacle is redacted: add its platform to the TileMap's exclusion zones
5. When a redaction expires: remove the exclusion zone

Non-solid obstacles (spikes, lasers, hazard zones) don't use TileMap collision — they use overlap checks directly in the test page's update loop.

### 5. Damage System (Simplified)

For the test page, damage is simplified:
- Track player HP as a number (default: 100)
- When player overlaps an active (non-redacted) obstacle that deals damage, subtract damage and apply brief invincibility (30 frames / 0.5s)
- Display HP in the debug panel
- On HP reaching 0, respawn at a fixed point (no death animation needed yet)
- Visual feedback: player flashes red briefly on hit, screen shake

This is a lightweight version of what will become the full combat damage system. Keep it simple — the focus is on redaction, not combat.

```typescript
// In the test page, not in the engine (keep it local for now):
interface PlayerHealth {
  hp: number;
  maxHp: number;
  invincibilityFrames: number;  // Remaining i-frames (decremented each physics tick)
  lastDamageSource: string | null;
}
```

### 6. Input Binding

Redaction uses a second ability slot:

In `InputManager.ts`, add (if not already present from Margin Stitch task):
```typescript
Ability1: "ability1",  // Margin Stitch
Ability2: "ability2",  // Redaction
```

Default key binding for Ability2: `q` (Q is next to E, easy to reach alongside Ability1).

If `Ability1` was already added by the Margin Stitch task, only add `Ability2`. Check the InputManager first.

### 7. Visual Design

The redaction visual should look like literal black ink redaction — a thick black bar drawn over the obstacle, like classified text being blacked out:

**Targeting visuals (when an obstacle is in range):**
- Thin red dashed outline around all redactable obstacles within range
- The targeted (nearest, in-aim-cone) obstacle gets a brighter red pulsing outline
- A faint aim cone rendered from the player in the aim direction (very subtle, 10% opacity)
- Small "crosshair" indicator on the targeted obstacle's center

**Activation visual (0.17s expansion):**
- A black rectangle starts at the center of the obstacle and expands outward to cover it fully
- Think: an ink blot expanding over text
- The expansion is smooth (lerp from center to full rect)
- Small ink splatter particles burst outward during expansion (dark colors)

**Active redaction visuals:**
- The obstacle is covered by a semi-transparent black rectangle (`#1a1a1a`, 80% opacity)
- Underneath, the original obstacle is faintly visible (ghost) at 20% opacity
- A thin timer bar below the redaction mark shows remaining duration
- Timer bar color: `#ef4444` (red) → empty as time runs out
- Small ink drop particles occasionally drip from the bottom of the redaction mark (1-2 per second, subtle)
- During the last 1 second: the black rectangle flickers, showing the original obstacle more

**Expiration visual:**
- The black rectangle "peels away" — shrinks from edges back to center (reverse of activation)
- Burst of ink particles as it restores
- Obstacle color briefly flashes brighter, then returns to normal

**Colors:**
- Targeting outline: `#ef4444` (red) at 40% opacity
- Targeted highlight: `#ef4444` at 70% opacity, pulsing
- Redaction ink: `#1a1a1a` (near-black) at 80% opacity
- Timer bar: `#ef4444` (red)
- Activation particles: `#1a1a1a`, `#374151`, `#4b5563` (dark grays/blacks)
- Drip particles: `#374151`, `#1f2937`
- Expiration particles: `#6b7280`, `#9ca3af` (lighter grays — ink dispersing)

### 8. Test Page (`/test/redaction`)

Replace the stub with a full test page.

**Test Level Layout (960×540, single screen):**

Design a room that showcases all redaction scenarios:

1. **Ground floor** — wide floor spanning the level. Player starts on the left.

2. **Spike pit** (x: 200-300) — A gap in the floor with spikes at the bottom. The player must redact the spikes to safely drop down and pass through. Tests basic spike redaction.

3. **Barrier wall** (x: 450, full height ~200px) — A solid barrier blocking the right side of the level. Player must redact it to pass through. Tests solid obstacle redaction with TileMap exclusion zones.

4. **Elevated platform with spikes on top** (x: 550-650, y: 300) — A platform with spikes on its surface. Player must redact the spikes to safely land on it. Tests precision targeting (redact spikes, not the platform).

5. **Double-barrier corridor** (x: 700-800) — Two barriers close together (~80px apart). Player must redact both to pass through. Tests multi-redaction (`maxActiveRedactions: 2`).

6. **Timed challenge area** (x: 850-960) — A barrier that blocks access to a goal platform. Player must redact it and reach the goal before the redaction expires. Tests timing and urgency.

7. **Overhead laser** (x: 350-450, y: ~200) — A horizontal laser beam above the ground that the player must redact or duck under. Tests non-solid obstacle redaction.

8. **Out-of-range obstacle** — A spike set at the far top of the level, beyond `maxRedactionRange`. Should NOT be targetable. Tests range limit.

9. **Boundary walls** — left, right, floor, ceiling.

**Debug Overlays (on canvas):**
- Player hitbox (cyan)
- All obstacle hitboxes (red outline when active, gray outline when redacted)
- Targeting cone from player (very faint)
- Target highlight on nearest eligible obstacle
- Active redaction mark overlays
- Redaction duration timer bars
- Cooldown indicator near player
- Range circle around player (faint dotted circle showing `maxRedactionRange`)
- HP bar above player
- Aim direction arrow from player center
- State readout: ability state (READY / ACTIVE / COOLDOWN), cooldown timer, active count, HP
- FPS counter, velocity, player state

**Debug Panel Sections (collapsible):**

1. **Redaction Info** (always visible):
   - Ability state: READY / COOLDOWN
   - Active redaction count / max
   - Cooldown timer (if on cooldown)
   - Targeted obstacle info (type, distance)
   - Player HP

2. **Redaction Params** (expanded by default):
   | Parameter | Min | Max | Step | Default | Description |
   |-----------|-----|-----|------|---------|-------------|
   | Max Range | 60 | 400 | 10 | 200 | Detection range for obstacles |
   | Duration | 1.0 | 15.0 | 0.5 | 5.0 | How long obstacle stays redacted |
   | Cooldown | 0.0 | 10.0 | 0.5 | 3.0 | Time before next redaction after one expires |
   | Max Active | 1 | 5 | 1 | 2 | Simultaneous redactions allowed |
   | Visual Speed | 1.0 | 15.0 | 0.5 | 6.0 | Expansion animation speed |
   | Aim Cone | 15 | 90 | 5 | 45 | Aim cone half-angle (degrees, converted to radians internally) |

3. **Damage & Health** (collapsed by default):
   | Parameter | Min | Max | Step | Default | Description |
   |-----------|-----|-----|------|---------|-------------|
   | Max HP | 50 | 200 | 10 | 100 | Player max health |
   | Spike Damage | 5 | 50 | 5 | 20 | Damage from spikes per hit |
   | Laser Damage | 5 | 50 | 5 | 10 | Damage from lasers per tick |
   | I-Frames | 10 | 60 | 5 | 30 | Invincibility frames after hit |

4. **Player State** (collapsed by default):
   - Current state, velocity, position, grounded, dash status
   - All movement params (ground, jump, wall, dash) as sliders

5. **Controls** (expanded by default):
   - Reset Player button (respawn + reset HP)
   - Reset Params button
   - Debug overlay toggle
   - Range circle toggle
   - Aim cone toggle

**Pass Criteria (display on page):**
1. Obstacles within range are highlighted with red targeting outlines
2. Directional aiming selects the obstacle closest to the aim direction
3. Pressing Q/ability key redacts the targeted obstacle
4. Redacted spikes become inert — player can walk through without taking damage
5. Redacted barriers become non-solid — player passes through them
6. Redaction activates from any movement state (IDLE, RUNNING, JUMPING, DASHING) without interruption
7. Black ink mark expands over the obstacle on activation (visual feedback)
8. Redaction expires after the duration timer — obstacle restores
9. Expired redaction shows visual "peel away" restoration
10. Player can have 2 active redactions simultaneously
11. Cooldown prevents immediate re-use after a redaction expires
12. Obstacles outside max range are NOT targetable
13. Player takes damage from active (non-redacted) spikes/lasers
14. Player does NOT take damage from redacted obstacles
15. HP reaches 0 → player respawns (not stuck in dead state)

Auto-detection for criteria:
- 1: `detectedObstacles.length > 0` when near an obstacle
- 2: `targetedObstacle` changes based on aim direction input
- 3: `activeRedactions.length > 0` after pressing ability key
- 4: Player overlaps redacted spike rect without HP decrease
- 5: Player position passes through barrier rect while it's redacted
- 6: Redaction activates while player is in various states (track activation source state)
- 7: Visual check (manual)
- 8: Obstacle `active` flips back to `true` after timer
- 9: Visual check (manual)
- 10: `activeRedactions.length === 2`
- 11: Activation fails during cooldown
- 12: Far obstacle never appears in `detectedObstacles`
- 13: Player HP decreases when overlapping active spike
- 14: Player HP stable when overlapping redacted spike
- 15: Respawn triggered when HP reaches 0

**Keyboard Controls:**
| Key | Action |
|-----|--------|
| Arrow Left/Right | Move |
| Arrow Up / Z | Jump |
| Arrow Down | Crouch |
| X / Shift | Dash |
| E | Activate Stitch (if integrated) |
| Q | Activate Redaction |
| D | Toggle debug overlays |

## Files to Create

- `src/engine/abilities/Redaction.ts` — Redaction ability system
- `src/engine/physics/Obstacles.ts` — Obstacle type definitions and helpers
- `src/app/test/redaction/page.tsx` — Full test page (replace stub)

## Files to Modify

- `src/engine/abilities/index.ts` — Export Redaction, Obstacles
- `src/engine/input/InputManager.ts` — Add `Ability2` action if not already present, bind to `q` key
- `src/engine/physics/index.ts` — Export Obstacle types
- `src/lib/testStatus.ts` — Update redaction status to `'in-progress'`

## Important Implementation Notes

1. **Zero flow interruption remains the #1 priority.** Redaction activates on a single button press. The player's state machine is NOT modified. No new player states. The redaction system operates independently — the player keeps moving while obstacles are erased and restored.

2. **Redaction is a world edit, not a player ability.** It modifies obstacle state and TileMap exclusion zones. The Player entity doesn't know redaction exists. The test page wires the input → redaction system → TileMap pipeline.

3. **Depends on Margin Stitch's exclusion zone system.** The Margin Stitch task adds `exclusionZones` to TileMap and modifies `resolveCollisions()` to skip excluded platforms. Redaction uses the same mechanism. If exclusion zones aren't implemented yet (Margin Stitch not done), this task must add them. Check TileMap first.

4. **Obstacle overlay checks are separate from TileMap collision.** Non-solid obstacles (spikes, lasers) use simple AABB overlap checks in the test page's update loop, not TileMap collision. Only solid obstacles (barriers) use TileMap exclusion zones.

5. **Obstacles are test-page-local for now.** The `Obstacle[]` array is created in the test page setup, not stored in a global registry. Later, when the room system is built, obstacles will be part of room data. For now, keep it simple.

6. **Aim direction uses existing input.** No new input actions needed for aiming — use the existing directional inputs (Left, Right, Up, Down). The aim direction is computed from held directional keys, defaulting to facing direction.

7. **Player ejection when redaction expires on a solid obstacle.** Same pattern as Margin Stitch: if the player is inside a barrier's rect when the redaction expires and collision re-enables, push the player to the nearest clear space. Use the same ejection logic established by Margin Stitch.

8. **Keep damage system minimal.** The health/damage code is local to the test page, not engine code. It's a simple HP counter with invincibility frames. Don't build a full combat damage system — that's Phase 3.

9. **Obstacle rendering goes on the 'world' layer** (below entities). Redaction mark visuals go on the 'fx' layer (above entities, below debug). This creates the visual hierarchy: obstacles → player → redaction marks → debug overlays.

10. **Use the existing ParticleSystem** from `src/engine/core/ParticleSystem.ts` for all redaction particles (activation burst, drips, expiration peel-away). Create a ParticleSystem instance in the test page setup.

11. **Follow the existing test page pattern.** Use `GameCanvas`, `DebugPanel`, `Slider` components. Follow the structure established by dash and transitions test pages.

12. **Performance: obstacle scanning is lightweight.** With ~10 obstacles in the test level, brute-force scanning every frame is trivial. No spatial optimization needed.

## Design Decisions (Pre-settled)

1. **Targeted (not area) redaction.** The player targets one obstacle at a time using directional aiming. This creates precision skill expression — choosing which obstacle to erase matters.
2. **Directional auto-aim with cone.** No manual cursor or reticle. The system selects the best obstacle in the player's aim direction within a 90° cone. Fast and flow-friendly.
3. **Multiple simultaneous redactions (max 2).** Creates timing puzzles — redact barrier A, run toward barrier B, redact B while A is still open, pass through both.
4. **Duration-based with visible timer.** Creates urgency and skill — get through before it restores. The timer bar makes timing visible.
5. **Obstacles are a new engine concept.** Separate from platforms. This sets up the pattern for later abilities and enemy interactions.
6. **Damage is test-page-local.** Not a full engine system yet. Just enough to prove that redacted obstacles are truly inert.
7. **Vertical aim + horizontal aim both work.** Can aim up to redact overhead lasers, aim down to redact spikes below, aim left/right to redact barriers. 8-directional aim via existing input.
8. **Visual style is "ink redaction" — black ink covering the obstacle.** Consistent with the hand-inked art direction. The redaction mark looks like literal censorship of dangerous text.

## Verification

- [ ] `npx tsc --noEmit` passes with zero errors
- [ ] `npm run build` succeeds
- [ ] Navigate to `/test/redaction` — canvas renders with test level, obstacles, and player
- [ ] Obstacles within range show red targeting highlights
- [ ] Aim direction (from held keys or facing) selects the nearest obstacle in the cone
- [ ] Pressing Q activates redaction on the targeted obstacle
- [ ] Activation visual: black ink mark expands over the obstacle
- [ ] Redacted spikes: player can overlap without taking damage
- [ ] Redacted barriers: player passes through (exclusion zone active)
- [ ] Unredacted obstacles: player takes damage from spikes, blocked by barriers
- [ ] Redaction timer counts down and obstacle restores on expiry
- [ ] Expiration visual: black mark peels away, obstacle restores
- [ ] Player inside barrier on restore is ejected safely
- [ ] Can redact 2 obstacles simultaneously
- [ ] Cooldown prevents immediate re-use
- [ ] Out-of-range obstacles not targetable
- [ ] All redaction params tunable via sliders
- [ ] HP system works: damage, invincibility frames, respawn on death
- [ ] Debug overlays: obstacle hitboxes, aim cone, range circle, redaction marks, timers
- [ ] All existing movement mechanics (run, jump, wall, dash) still work
- [ ] FPS stays at ~60fps
- [ ] Reset buttons work

---

## Implementation Summary

### Files Created
- **`src/engine/physics/Obstacles.ts`** — Obstacle type system with `ObstacleType` union, `Obstacle` interface, factory helpers (`createSpikes`, `createBarrier`, `createLaser`, `createHazardZone`), and overlap check utilities (`checkObstacleOverlap`, `checkDamageOverlap`).
- **`src/engine/abilities/Redaction.ts`** — Full Redaction ability system: `Redaction` class with targeting cone-based scanning, activate/update/expire lifecycle, TileMap exclusion zone integration for solid barriers, player ejection on restore, and visual rendering (targeting outlines, ink mark expansion, timer bars, drip/burst particles). Also exports `getAimDirection()` helper.
- **`src/app/test/redaction/page.tsx`** — Complete test page replacing the stub. Features:
  - Test level with spike pit, barrier wall, elevated platform with spikes, double-barrier corridor, timed challenge barrier, overhead laser, and out-of-range obstacle
  - Directional aim-cone-based targeting (uses held directional input or facing direction)
  - Q key activates redaction on targeted obstacle
  - Redacted spikes become inert (no damage), redacted barriers become passable (exclusion zones)
  - Duration timer with visual countdown bars
  - Obstacle restoration on expiry with player ejection
  - Simplified HP/damage system with invincibility frames, screen shake, and respawn on death
  - Full debug overlays: hitboxes, aim cone, range circle, obstacle outlines, redaction marks, HP bar, state diagnostics
  - Debug panel with collapsible sections: Redaction Info, Redaction Params (6 sliders), Damage & Health (4 sliders), Player Movement (4 sliders), Controls (reset/toggle buttons)
  - 15 auto-tracked pass criteria
  - Particle effects for activation, drips, and expiration

### Files Modified
- **`src/engine/input/InputManager.ts`** — Added `Ability2: "ability2"` to `InputAction` and bound `q` key to it.
- **`src/engine/abilities/index.ts`** — Added exports for `Redaction`, `DEFAULT_REDACTION_PARAMS`, `getAimDirection`, and related types.
- **`src/engine/physics/index.ts`** — Added exports for all Obstacles types and helpers.
- **`src/lib/testStatus.ts`** — Updated Redaction status from `"not-started"` to `"in-progress"`.

### Key Design Decisions
- Redaction operates independently of the player state machine (zero flow interruption)
- Solid obstacles (barriers) use TileMap exclusion zones (same system as Margin Stitch)
- Non-solid obstacles (spikes, lasers) use direct AABB overlap checks for damage
- Damage system is test-page-local (not engine code), using refs for real-time slider updates
- Visual style: black ink redaction mark expanding from center, with timer bar and particle effects

### Verification
- `npx tsc --noEmit` passes with zero errors
- `npm run build` succeeds (27 routes generated)

---

## Review Notes (Reviewer: 605ac578)

### Files Reviewed
- `src/engine/physics/Obstacles.ts` — clean, well-typed, correct AABB usage
- `src/engine/abilities/Redaction.ts` — core logic sound, aim cone math correct
- `src/app/test/redaction/page.tsx` — full test page, all patterns match codebase conventions
- `src/engine/input/InputManager.ts` — Ability2 added correctly
- `src/engine/abilities/index.ts` — exports correct
- `src/engine/physics/index.ts` — exports correct
- `src/lib/testStatus.ts` — status updated to "in-progress"

### Fixes Applied

1. **Removed dead `renderUI` method from `Redaction.ts`** — The method (lines 342-403) implemented range circle, aim cone, aim arrow, and cooldown indicator rendering in screen space. However, the test page already implements all of this directly in its debug layer callback (lines 827-892). The method was never called anywhere. Removed to avoid confusion and dead code.

2. **Fixed misleading controls legend in test page** — The controls legend stated "D = Toggle debug" but the `d` key is mapped to `InputAction.Right` (move right) in the InputManager. There is no keyboard shortcut for debug toggling; it's done via the sidebar buttons. Removed the misleading "D = Toggle debug" text.

### Design Notes (No Fix Needed)

- **Cooldown stacking**: When multiple active redactions expire at different times, each expiration resets the cooldown timer. This means two back-to-back expirations extend the effective cooldown. This is the natural behavior given the "cooldown per expiration" design.

- **Screen shake in update loop**: The shake offset is added to `camera.position` in the update callback. While applying shake in the render pass would be more idiomatic, the smoothing step at the start of each update frame overwhelms any accumulated offset, so the shake effect works correctly in practice.

- **Criterion 12 trivially satisfied**: The "out-of-range not targetable" criterion is set to `true` on the very first frame since the out-of-range obstacle is always beyond range. Cosmetic — the criterion is logically correct, just not strongly validated.

### Verification After Fixes
- `npx tsc --noEmit` passes with zero errors
- `npm run build` succeeds (27 routes generated)
