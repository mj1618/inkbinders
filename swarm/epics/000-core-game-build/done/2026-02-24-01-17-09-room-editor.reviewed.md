# Task: Room Editor — Layout Sandbox, Room Connections, and Ability Gates

## Overview

Implement the **Room System** and **Room Editor** with test page (`/test/room-editor`). This is Phase 4, step 19 — the final World Systems feature. It creates the infrastructure that connects every other system: rooms are containers for platforms, obstacles, enemies, vines, ability gates, and biome themes. The Room Editor is a visual sandbox for designing and testing room layouts.

Without this, every feature exists only in isolated test pages. The room system is the bridge to Phase 5 content (biomes as connected areas) and Phase 6 (60–90 room world assembly).

**This task is independent of Day/Night Cycle and Ink Cards** — it builds on Phase 1 movement, Phase 2 abilities (for gates), and existing TileMap/Platform/Obstacle types.

## Dependencies

- TileMap + Platform system ✅ (`src/engine/physics/TileMap.ts`)
- Obstacles system ✅ (`src/engine/physics/Obstacles.ts`)
- Surface types ✅ (`src/engine/physics/Surfaces.ts`)
- BiomeTheme ✅ (`src/engine/world/Biome.ts`)
- VineAnchor ✅ (`src/engine/world/VineSystem.ts`)
- Player entity ✅ (`src/engine/entities/Player.ts`)
- Camera system ✅ (`src/engine/core/Camera.ts`)
- Enemy types ✅ (`src/engine/entities/enemies/`)
- Engine core ✅
- GameCanvas, DebugPanel, Slider ✅

## What to Build

### 1. Room Data Model (`src/engine/world/Room.ts`)

The serializable room definition. A room is a rectangular area containing all the elements needed to play it.

```typescript
import type { Rect, Vec2 } from "@/lib/types";
import type { SurfaceType } from "@/engine/physics/Surfaces";
import type { ObstacleType } from "@/engine/physics/Obstacles";

/** Unique room identifier */
export type RoomId = string;

/** Direction the player can exit a room */
export type ExitDirection = 'left' | 'right' | 'top' | 'bottom';

/** Which ability is needed to pass through a gate */
export type GateAbility = 'margin-stitch' | 'redaction' | 'paste-over' | 'index-mark';

/** Serializable platform definition */
export interface RoomPlatform {
  x: number;
  y: number;
  width: number;
  height: number;
  surfaceType?: SurfaceType;
}

/** Serializable obstacle definition */
export interface RoomObstacle {
  id: string;
  rect: Rect;
  type: ObstacleType;
  damage: number;
  solid: boolean;
}

/** A connection from this room to another room */
export interface RoomExit {
  /** Which edge of this room the exit is on */
  direction: ExitDirection;
  /** The zone where the player triggers the exit (relative to room origin) */
  zone: Rect;
  /** The room this exit leads to */
  targetRoomId: RoomId;
  /** Where the player spawns in the target room (relative to target room origin) */
  targetSpawnPoint: Vec2;
}

/** An ability gate — a barrier that requires a specific ability to pass */
export interface AbilityGate {
  id: string;
  /** Gate position and size */
  rect: Rect;
  /** Which ability is needed */
  requiredAbility: GateAbility;
  /** Visual color when locked */
  lockedColor: string;
  /** Whether the gate has been opened (persists within session) */
  opened: boolean;
}

/** Enemy spawn point */
export interface EnemySpawn {
  id: string;
  position: Vec2;
  type: 'reader' | 'binder' | 'proofwarden';
  /** Patrol range for Reader, firing range for Binder, etc. */
  patrolRange?: number;
  /** Ground Y for simple enemy physics */
  groundY: number;
  /** Which direction the enemy faces initially */
  facingRight: boolean;
}

/** Vine anchor placement */
export interface RoomVineAnchor {
  id: string;
  position: Vec2;
  ropeLength: number;
  type: 'hanging' | 'ceiling' | 'branch';
}

/** Complete room definition — everything needed to instantiate a room */
export interface RoomData {
  /** Unique room identifier */
  id: RoomId;
  /** Display name */
  name: string;
  /** Room dimensions (width × height in pixels) */
  width: number;
  height: number;
  /** Biome theme ID (references BiomeTheme.id) */
  biomeId: string;
  /** Player spawn point when entering this room for the first time */
  defaultSpawn: Vec2;
  /** All platforms in this room */
  platforms: RoomPlatform[];
  /** All obstacles */
  obstacles: RoomObstacle[];
  /** Exits to other rooms */
  exits: RoomExit[];
  /** Ability gates */
  gates: AbilityGate[];
  /** Enemy spawns */
  enemies: EnemySpawn[];
  /** Vine anchors (Herbarium Folio biome) */
  vineAnchors: RoomVineAnchor[];
}
```

### 2. Room Manager (`src/engine/world/RoomManager.ts`)

Runtime system that loads rooms, handles transitions, and manages the current room state.

```typescript
export interface RoomManagerConfig {
  /** All rooms in the world */
  rooms: Map<RoomId, RoomData>;
  /** Starting room */
  startingRoomId: RoomId;
}

export class RoomManager {
  /** The currently active room */
  currentRoom: RoomData;
  /** The TileMap built from the current room's platforms */
  currentTileMap: TileMap;
  /** Active obstacles in the current room */
  currentObstacles: Obstacle[];
  /** Active ability gates */
  currentGates: AbilityGate[];
  /** Active enemy spawns */
  currentEnemies: EnemySpawn[];
  /** Active vine anchors */
  currentVineAnchors: VineAnchor[];
  /** Transition state */
  transitioning: boolean;
  transitionProgress: number; // 0-1
  transitionDirection: ExitDirection | null;

  constructor(config: RoomManagerConfig);

  /** Load a room by ID — builds TileMap, obstacles, gates from RoomData */
  loadRoom(roomId: RoomId): void;

  /** Check if the player is overlapping any exit zone */
  checkExits(playerRect: Rect): RoomExit | null;

  /** Initiate a room transition (fade-out → load → fade-in) */
  startTransition(exit: RoomExit): void;

  /** Update transition animation */
  updateTransition(dt: number): void;

  /** Check if player can pass through an ability gate */
  tryOpenGate(gate: AbilityGate, playerAbilities: Set<GateAbility>): boolean;

  /** Render room transition overlay (fade effect) */
  renderTransition(ctx: CanvasRenderingContext2D): void;
}
```

Key behaviors:
- **Room loading:** Convert `RoomData` → live `TileMap` + `Obstacle[]` + gates + enemies + vines. This is the bridge from serialized data to runtime objects.
- **Exit detection:** Each frame, check if the player's bounding box overlaps any `RoomExit.zone`. If so, trigger a transition.
- **Transition animation:** Simple fade-to-black (0.3s fade out → swap room → 0.3s fade in). During fade, player input is suppressed. Player spawns at `targetSpawnPoint` in the new room.
- **Ability gates:** Rendered as colored barriers. When the player approaches and has the required ability, the gate visually dissolves (particle effect) and opens permanently (session-scoped — no persistence yet).
- **Gate colors by ability:**
  - `margin-stitch`: cyan (#22d3ee)
  - `redaction`: red (#ef4444)
  - `paste-over`: amber (#f59e0b)
  - `index-mark`: purple (#a78bfa)

### 3. Room Renderer (`src/engine/world/RoomRenderer.ts`)

Handles rendering of room-specific elements that go beyond the basic TileMap rendering.

```typescript
export class RoomRenderer {
  /** Render ability gates */
  renderGates(ctx: CanvasRenderingContext2D, gates: AbilityGate[]): void;

  /** Render exit zone indicators (subtle arrows at room edges) */
  renderExitIndicators(ctx: CanvasRenderingContext2D, exits: RoomExit[]): void;

  /** Render room bounds outline */
  renderBounds(ctx: CanvasRenderingContext2D, width: number, height: number): void;

  /** Render room transition fade overlay */
  renderTransitionOverlay(ctx: CanvasRenderingContext2D, progress: number, direction: ExitDirection): void;
}
```

Gate rendering:
- Locked gates: Semi-transparent colored rectangle with ability icon/glyph, subtle pulse animation
- Opened gates: Dissolve particle effect then invisible (no collision)
- Exit indicators: Small directional arrows at the edge, subtle glow/pulse

### 4. Room Editor System (`src/engine/world/RoomEditor.ts`)

The interactive editor — click to place, drag to resize, select and delete.

```typescript
export type EditorTool =
  | 'select'    // Click to select elements, drag to move
  | 'platform'  // Click-drag to create platforms
  | 'obstacle'  // Click to place obstacles
  | 'exit'      // Click to place exit zones
  | 'gate'      // Click to place ability gates
  | 'enemy'     // Click to place enemy spawns
  | 'vine'      // Click to place vine anchors
  | 'spawn'     // Click to set player spawn point
  | 'erase';    // Click to delete any element

export interface EditorState {
  /** Currently selected tool */
  activeTool: EditorTool;
  /** Selected element (for moving/editing) */
  selectedElement: { type: string; id: string } | null;
  /** Grid snap size (0 = no snap) */
  gridSize: number;
  /** Whether grid is visible */
  showGrid: boolean;
  /** Obstacle subtype for placement */
  obstacleSubtype: ObstacleType;
  /** Surface type for platform placement */
  surfaceSubtype: SurfaceType;
  /** Enemy type for placement */
  enemySubtype: 'reader' | 'binder' | 'proofwarden';
  /** Ability for gate placement */
  gateAbility: GateAbility;
  /** Whether currently dragging to create a rect */
  dragging: boolean;
  dragStart: Vec2 | null;
  dragCurrent: Vec2 | null;
}

export class RoomEditor {
  state: EditorState;
  room: RoomData;

  /** Convert screen coordinates to world coordinates (accounting for camera) */
  screenToWorld(screenX: number, screenY: number, camera: Camera): Vec2;

  /** Snap a world position to grid */
  snapToGrid(pos: Vec2): Vec2;

  /** Handle mouse down — start drag or select element */
  onMouseDown(worldPos: Vec2): void;

  /** Handle mouse move — update drag preview or move selected */
  onMouseMove(worldPos: Vec2): void;

  /** Handle mouse up — finalize placement */
  onMouseUp(worldPos: Vec2): void;

  /** Handle keyboard shortcuts (Delete to erase, G to toggle grid, etc.) */
  onKeyDown(key: string): void;

  /** Delete selected element */
  deleteSelected(): void;

  /** Export room as JSON (serializable RoomData) */
  exportRoom(): RoomData;

  /** Import room from JSON */
  importRoom(data: RoomData): void;

  /** Render editor UI (grid, selection highlight, drag preview, tool cursor) */
  renderEditor(ctx: CanvasRenderingContext2D, camera: Camera): void;

  /** Create a new empty room */
  newRoom(width: number, height: number, biomeId: string): void;
}
```

Key editor behaviors:
- **Grid snap:** Default 32px grid (tunable via slider). All placements snap to grid when enabled.
- **Platform tool:** Click-drag to define a rectangle. Shows ghost preview while dragging. Released to place.
- **Obstacle tool:** Click to place at grid-snapped position. Uses current obstacleSubtype setting. Default size: 32×32 for spikes, 32×64 for barriers.
- **Exit tool:** Click-drag on room edge to define exit zone. Must be adjacent to room boundary (left, right, top, or bottom edge).
- **Gate tool:** Click to place ability gate. Uses current gateAbility setting. Default size: 16×96 (vertical barrier).
- **Enemy tool:** Click to place enemy spawn. Uses current enemySubtype. Sets groundY from nearest platform below.
- **Vine tool:** Click to place vine anchor at ceiling/platform undersides. Default ropeLength: 120px.
- **Spawn tool:** Click to set player default spawn point. Only one per room — replaces previous.
- **Select tool:** Click to select any element (highlights it). Selected element can be dragged to move. Delete key removes it.
- **Erase tool:** Click on any element to delete it immediately.
- **Grid rendering:** Light dotted grid lines, with heavier lines every 4 cells. Toggled with G key.

### 5. Test Page (`src/app/test/room-editor/page.tsx`)

Replace the stub with a full interactive room editor test page.

**Layout:**
- Left: Canvas (960×540) showing the editable room
- Right: Debug panel with:
  - **Tool selector:** Row of buttons for each EditorTool
  - **Tool options:** Contextual sub-options (obstacle type dropdown, surface type dropdown, enemy type dropdown, gate ability dropdown)
  - **Room settings:** Width/height sliders, biome theme selector, room name text input
  - **Grid settings:** Grid size slider (8/16/32/64), grid visibility toggle
  - **Room controls:** "New Room" button, "Export JSON" button, "Import JSON" button, "Play Test" toggle
  - **Room connections panel:** List of exits with target room dropdowns
  - **Preset rooms:** "Load Preset" dropdown with 3 pre-built example rooms

**Test page modes:**
1. **Edit mode** (default): Full editor tools active. Click/drag to place elements. Player is not simulated.
2. **Play mode** (toggle with "Play Test" button or P key): Editor tools hidden. Player spawns at defaultSpawn. Full movement + ability system active. Can test exits, gates, enemies. Press P again to return to edit mode.

**Three preset rooms (for testing without manual building):**

**Preset 1: "Tutorial Corridor"**
- 1920×540 room
- Flat floor with a few platforms at varying heights
- One redaction gate (barrier in the middle)
- One exit right (leads to Preset 2)
- Player spawn at left side
- 2 Reader enemies

**Preset 2: "Vertical Shaft"**
- 960×1080 room (tall)
- Wall-jump-friendly vertical shaft with platforms
- Vine anchors at top section (2 vines)
- One margin-stitch gate (two walls that can be stitched)
- Exit left (back to Preset 1), exit top (leads to Preset 3)
- 1 Proofwarden enemy

**Preset 3: "Vine Garden"**
- 1920×1080 room (large)
- Herbarium Folio theme
- Multiple vine anchors (4-5 vines for swinging sequences)
- Paste-over surfaces (bouncy, icy platforms)
- Exit bottom (back to Preset 2)
- 2 Binder enemies
- Index Mark gate at far end

**Play mode wiring:**
- Build `TileMap` from `room.platforms`
- Build `Obstacle[]` from `room.obstacles` (use factory helpers from Obstacles.ts)
- Instantiate `Player` at `room.defaultSpawn`
- Instantiate enemies from `room.enemies`
- Build `VineAnchor[]` from `room.vineAnchors`
- Wire `RoomManager` for exit detection and transitions between preset rooms
- Render gates with `RoomRenderer`
- Player abilities: give the player all abilities for testing (stitch, redaction, paste-over, index-mark all available)
- Show room transition fade when walking through exits

**Canvas rendering layers (in order):**
1. Background (biome-themed or default dark)
2. Grid (editor mode only)
3. Platforms (TileMap.render — color-coded by surface type)
4. Obstacles (rendered with type-appropriate visuals)
5. Ability gates (colored barriers with glyph)
6. Exit zone indicators (arrows at edges)
7. Enemy spawns (editor mode: icons; play mode: live enemies)
8. Vine anchors (editor mode: markers; play mode: live vines)
9. Player spawn point (editor mode: crosshair marker)
10. Player (play mode only)
11. Editor selection/drag preview (editor mode only)
12. Debug overlay (velocity, state, FPS)
13. Transition overlay (play mode room transitions)

## Specific Values and Constants

```typescript
// Room defaults
const DEFAULT_ROOM_WIDTH = 960;
const DEFAULT_ROOM_HEIGHT = 540;
const MIN_ROOM_WIDTH = 480;
const MAX_ROOM_WIDTH = 3840;
const MIN_ROOM_HEIGHT = 540;
const MAX_ROOM_HEIGHT = 2160;

// Editor grid
const DEFAULT_GRID_SIZE = 32;
const GRID_SIZES = [8, 16, 32, 64];
const GRID_LINE_COLOR = 'rgba(255, 255, 255, 0.06)';
const GRID_MAJOR_COLOR = 'rgba(255, 255, 255, 0.12)';
const GRID_MAJOR_INTERVAL = 4; // Heavy line every 4 grid cells

// Transition
const TRANSITION_FADE_DURATION = 0.3; // seconds for fade-out and fade-in each
const TRANSITION_TOTAL_DURATION = 0.7; // fade-out + brief hold + fade-in

// Exit zones
const EXIT_ZONE_DEPTH = 16; // How deep the exit trigger zone is
const EXIT_INDICATOR_SIZE = 12; // Arrow size at room edges
const EXIT_INDICATOR_COLOR = 'rgba(255, 255, 255, 0.4)';

// Ability gate colors
const GATE_COLORS: Record<GateAbility, string> = {
  'margin-stitch': '#22d3ee',
  'redaction': '#ef4444',
  'paste-over': '#f59e0b',
  'index-mark': '#a78bfa',
};
const GATE_WIDTH = 16;
const GATE_HEIGHT = 96;
const GATE_PULSE_SPEED = 2; // Hz
const GATE_PULSE_ALPHA_RANGE = [0.3, 0.7]; // Min/max alpha for pulse

// Editor
const SELECTION_COLOR = '#22d3ee';
const SELECTION_LINE_WIDTH = 2;
const DRAG_PREVIEW_ALPHA = 0.4;
const MIN_PLATFORM_SIZE = 16; // Minimum platform dimension
```

## Files to Create

1. **`src/engine/world/Room.ts`** — Room data model (types and interfaces)
2. **`src/engine/world/RoomManager.ts`** — Runtime room loading, exit detection, transitions
3. **`src/engine/world/RoomRenderer.ts`** — Gate rendering, exit indicators, transition overlay
4. **`src/engine/world/RoomEditor.ts`** — Interactive editor with tools, grid, selection, import/export
5. **`src/engine/world/presetRooms.ts`** — Three preset room definitions for testing
6. **`src/app/test/room-editor/page.tsx`** — Full test page (replace stub)

## Files to Modify

1. **`src/lib/testStatus.ts`** — Update room-editor status from `"not-started"` to `"in-progress"`
2. **`src/engine/world/index.ts`** — Export new room modules

## How to Wire It Together in the Test Page

The test page has two modes. The key architectural pattern:

**Edit Mode:**
```
useEffect setup:
  - Create Engine (canvas, game loop)
  - Create RoomEditor with empty room
  - Register mouse event listeners on canvas (mousedown/mousemove/mouseup → roomEditor methods)
  - Register keyboard listener for editor shortcuts (G, Delete, P, Escape)
  - engine.onRender: render grid → platforms → obstacles → gates → exits → enemies → vines → spawn → selection

React panel:
  - Tool buttons update roomEditor.state.activeTool
  - Sub-tool dropdowns update roomEditor.state subtypes
  - Room settings sliders update room dimensions
  - Export/Import buttons use roomEditor.exportRoom() / importRoom()
  - Preset dropdown calls roomEditor.importRoom(PRESET_ROOMS[name])
```

**Play Mode (toggled with P key or button):**
```
On enter play mode:
  - Build TileMap from current room platforms
  - Build Obstacles from current room obstacles
  - Create Player at room.defaultSpawn
  - Create enemies from room.enemies
  - Build VineAnchors from room.vineAnchors
  - Create RoomManager with all preset rooms loaded
  - Wire engine.onUpdate: player.update → collision → exit check → transition update → enemy update → vine update
  - Wire engine.onRender: background → platforms → obstacles → gates → exits → vines → enemies → player → debug → transition

On exit play mode (P again):
  - Destroy player, enemies, room manager
  - Return to editor view
```

## Pass Criteria

Display these on the test page:

1. **Platform tool works** — Can click-drag to create platforms of any size, with grid snapping
2. **All element types placeable** — Platforms, obstacles, exits, gates, enemies, vines, spawn point
3. **Select and move** — Can select any placed element and drag it to a new position
4. **Delete works** — Can delete selected elements with Delete key or Erase tool
5. **Grid snap** — Elements snap to grid. Grid size is adjustable. Grid visibility toggleable.
6. **Play mode** — P key toggles play mode. Player spawns and can move around the designed room.
7. **Room transitions** — Walking into exit zones triggers fade transition to connected preset room
8. **Ability gates** — Gates block movement. In play mode with abilities available, approaching gate with correct ability opens it.
9. **Export/Import** — Export produces valid JSON. Import restores the room exactly.
10. **Preset rooms load** — All 3 preset rooms load correctly and are playable in play mode with transitions between them.

## Notes

- **No Convex persistence** — rooms are session-scoped. Export/import is via JSON strings (copy/paste or browser localStorage). Convex integration comes later in Phase 6.
- **Camera in editor mode** — For rooms larger than 960×540, the editor needs panning. Use middle-mouse-drag or hold Space+drag to pan the camera. Zoom is not needed yet (rooms are designed at 1:1 pixel scale).
- **Enemy AI in play mode** — Enemies use their full AI when play mode is active. Import the Reader, Binder, Proofwarden classes and instantiate based on spawn type.
- **Vine system in play mode** — If room has vine anchors, instantiate VineSystem and wire it for the Herbarium Folio vine grapple interaction.
- **Ability gates are solid** — Add gate platforms to the TileMap when gates are locked. Remove from TileMap (exclusion zone) when opened.
- **Mouse coordinate conversion** — The editor must convert screen mouse coordinates to world coordinates via the Camera. Use `camera.screenToWorld()` if it exists, or compute: `worldX = screenX + camera.x - canvasWidth/2`, `worldY = screenY + camera.y - canvasHeight/2`.

---

## Implementation Summary

### Files Created

1. **`src/engine/world/Room.ts`** — Complete room data model with all types (RoomData, RoomPlatform, RoomObstacle, RoomExit, AbilityGate, EnemySpawn, RoomVineAnchor), constants (grid, gate colors, transition durations), and helper functions (createEmptyRoom, nextRoomElementId).

2. **`src/engine/world/RoomManager.ts`** — Runtime room management: loads RoomData into live TileMap + Obstacle[] + gates, handles room transitions (fade-to-black with 0.3s in/out), exit zone detection, ability gate opening with TileMap platform removal, session-scoped gate persistence across room transitions.

3. **`src/engine/world/RoomRenderer.ts`** — Static rendering functions: renderGates (pulsing colored barriers with ability glyph), renderExitIndicators (directional arrows at room edges), renderBounds (dashed room outline), renderTransitionOverlay (fade-to-black), renderSpawnMarker (crosshair), renderEnemyMarker (color-coded by type), renderVineMarker (anchor with dashed rope).

4. **`src/engine/world/RoomEditor.ts`** — Interactive editor class with 9 tools (select, platform, obstacle, exit, gate, enemy, vine, spawn, erase), grid snap, hit testing, element selection/drag/move/delete, import/export via JSON, grid rendering with major/minor lines, drag preview rendering, middle-mouse camera panning.

5. **`src/engine/world/presetRooms.ts`** — Three preset room definitions:
   - Tutorial Corridor (1920×540): flat floor, stepping platforms, spikes, redaction gate, 2 Readers, right exit
   - Vertical Shaft (960×1080): wall-jump shaft, margin-stitch gate, 1 Proofwarden, 2 vines, left/top exits
   - Vine Garden (1920×1080): herbarium-folio biome, bouncy/icy surfaces, 5 vines, paste-over + index-mark gates, 2 Binders, bottom exit

### Files Modified

6. **`src/app/test/room-editor/page.tsx`** — Replaced stub with full test page:
   - Edit mode: canvas with all editor tools, grid, selection, element markers
   - Play mode: player spawns with full movement, TileMap collision, ability gates auto-open on proximity, room transitions via exit zones, camera follow
   - Debug panel: tool buttons, contextual subtool dropdowns, grid controls, room settings (name/width/height), import/export/new room buttons, preset loader, element stats
   - 10 pass criteria displayed in footer

7. **`src/lib/testStatus.ts`** — Room Editor status updated to `"in-progress"`

8. **`src/engine/world/index.ts`** — Added exports for all new Room, RoomManager, RoomRenderer, RoomEditor, and presetRooms modules

### Type Check

All new code passes `npx tsc --noEmit` clean. The only error is a pre-existing issue in `src/engine/entities/index.ts` (DamageZone export from FootnoteGiant).

---

## Review Notes (Reviewer: aa27bb59)

### Files Reviewed
All 8 files (6 created, 2 modified) were read and analyzed against existing engine APIs.

### Issues Found and Fixed

**Bug 1 — Stale obstacles after room transition** (`src/app/test/room-editor/page.tsx`)
- After a room transition in play mode, `obstaclesRef.current` was never updated to the new room's obstacles. The render callback used `obstaclesRef.current` to draw obstacles, meaning the old room's obstacles were rendered in the new room.
- **Fix:** Added `obstaclesRef.current = roomManager.currentObstacles;` in the transition result handler (alongside the existing TileMap sync).

**Bug 2 — Room width/height sliders didn't update the room** (`src/app/test/room-editor/page.tsx`)
- The Width and Height sliders in the Room section only updated React state (`roomWidth`/`roomHeight`) but did not actually modify `editor.room.width`/`editor.room.height`. The grid, bounds, and all element placement depended on the room's dimensions, so the sliders were visually updating but functionally inert.
- **Fix:** Replaced `onChange={setRoomWidth}` / `onChange={setRoomHeight}` with inline handlers that also update `editor.room.width`/`.height` and the camera bounds.

### Items Verified (No Issues)
- **Room.ts**: Types, constants, helpers all correct. Module-level ID counter acceptable.
- **RoomManager.ts**: Constructor, loadRoom, transition logic, gate opening all correct. Transition midpoint swap correctly computed. Gate platform removal via splice is intentional (matches project patterns).
- **RoomRenderer.ts**: All render functions reset globalAlpha at end. Gate pulse alpha range stays within bounds (max stroke alpha = 0.9). Line dash properly cleared after use.
- **RoomEditor.ts**: Hit testing, placement, grid rendering, import/export all correct. `panStart` world position is unused (screen delta computed externally) — minor dead state but not a bug. `pointInRect` helper is correct.
- **presetRooms.ts**: Room layouts verified — exit spawn points are within room bounds and clear of collision. Vine Garden bottom exit correctly maps back to Vertical Shaft ceiling gap area.
- **testStatus.ts**: Room Editor status correctly set to `"in-progress"`.
- **world/index.ts**: All new exports present and typed correctly.
- **Event listener cleanup**: Canvas mouse events and window keydown listener are properly removed in the cleanup function. Engine stop is called on unmount.
- **Type safety**: No `any` types. All existing API signatures match usage (verified against Camera, Engine, TileMap, Player, Obstacles, Surfaces, AABB, VineSystem, Renderer).
- **No frame-rate dependent issues**: Transition uses `dt` properly. Gate pulse uses time-based sinusoid.

### Type Check After Fixes
`npx tsc --noEmit` passes clean (only pre-existing DamageZone export error remains).
