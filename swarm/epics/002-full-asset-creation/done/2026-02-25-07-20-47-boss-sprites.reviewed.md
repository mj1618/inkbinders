# Task: Sprite Sheets and Animation Controllers for All 3 Bosses

## Overview

Add sprite sheet definitions, animation controllers, and RenderConfig-aware rendering to all 3 bosses (Footnote Giant, Misprint Seraph, Index Eater). Follow the exact same pattern established in `Player.ts` and being applied to enemies in `EnemySprites.ts` — define sprite configs, animation defs, and state→animation mappings in a shared `BossSprites.ts` file, then integrate `AnimationController` into each boss's `render()` method with dual-mode support.

Each boss's existing hand-crafted rectangle rendering (glyphs, wings, segments, etc.) is preserved as the "rectangles" mode. Sprites replace only the main body rectangle — all attack telegraphs, projectiles, shockwaves, overlays, and vulnerability indicators remain drawn with canvas primitives regardless of render mode, since these are gameplay-critical visual feedback.

## What to Build

### 1. Create `src/engine/entities/bosses/BossSprites.ts`

A single file defining all boss sprite configs, animations, and state→animation mappings — one section per boss. Follows the `PlayerSprites.ts` and `EnemySprites.ts` pattern exactly.

**Footnote Giant sprites** (128×128 frames — large, heavy character):

| Sheet ID | Filename | Frames | Cols | Animations |
|----------|----------|--------|------|------------|
| `giant-idle` | `giant-idle-sheet.png` | 4 | 4 | `idle`: [0,1,2,3] @ 3fps, loop |
| `giant-stomp` | `giant-stomp-sheet.png` | 4 | 4 | `stomp-telegraph`: [0] @ 1fps, no-loop; `stomp-slam`: [1,2] @ 12fps, no-loop; `stomp-stuck`: [3] @ 1fps, no-loop |
| `giant-sweep` | `giant-sweep-sheet.png` | 4 | 4 | `sweep-telegraph`: [0] @ 1fps, no-loop; `sweep`: [1,2,3] @ 10fps, no-loop |
| `giant-vulnerable` | `giant-vulnerable-sheet.png` | 2 | 2 | `vulnerable`: [0,1] @ 4fps, loop |
| `giant-death` | `giant-death-sheet.png` | 4 | 4 | `death`: [0,1,2,3] @ 4fps, no-loop |

```typescript
export const GIANT_STATE_TO_ANIMATION: Record<string, { sheetId: string; animName: string }> = {
  IDLE:               { sheetId: "giant-idle",       animName: "idle" },
  PILLAR_TELEGRAPH:   { sheetId: "giant-stomp",      animName: "stomp-telegraph" },
  PILLAR_SLAM:        { sheetId: "giant-stomp",      animName: "stomp-slam" },
  PILLAR_STUCK:       { sheetId: "giant-stomp",      animName: "stomp-stuck" },
  PILLAR_RECOVER:     { sheetId: "giant-idle",       animName: "idle" },
  INK_RAIN_TELEGRAPH: { sheetId: "giant-idle",       animName: "idle" },
  INK_RAIN:           { sheetId: "giant-idle",       animName: "idle" },
  CITATION_TELEGRAPH: { sheetId: "giant-stomp",      animName: "stomp-telegraph" },
  CITATION_STAMP:     { sheetId: "giant-stomp",      animName: "stomp-slam" },
  CITATION_RECOVERY:  { sheetId: "giant-vulnerable", animName: "vulnerable" },
  SWEEP_TELEGRAPH:    { sheetId: "giant-sweep",      animName: "sweep-telegraph" },
  SWEEP:              { sheetId: "giant-sweep",      animName: "sweep" },
  SWEEP_RECOVERY:     { sheetId: "giant-vulnerable", animName: "vulnerable" },
  PHASE_TRANSITION:   { sheetId: "giant-idle",       animName: "idle" },
  DYING:              { sheetId: "giant-death",      animName: "death" },
  DEAD:               { sheetId: "giant-death",      animName: "death" },
};
```

**Misprint Seraph sprites** (128×128 frames — floaty, winged character):

| Sheet ID | Filename | Frames | Cols | Animations |
|----------|----------|--------|------|------------|
| `seraph-hover` | `seraph-hover-sheet.png` | 4 | 4 | `hover`: [0,1,2,3] @ 6fps, loop |
| `seraph-dive` | `seraph-dive-sheet.png` | 3 | 3 | `dive-telegraph`: [0] @ 1fps, no-loop; `dive`: [1,2] @ 12fps, no-loop |
| `seraph-cast` | `seraph-cast-sheet.png` | 4 | 4 | `cast-telegraph`: [0] @ 1fps, no-loop; `cast`: [1,2,3] @ 8fps, no-loop |
| `seraph-stagger` | `seraph-stagger-sheet.png` | 2 | 2 | `stagger`: [0,1] @ 4fps, loop |
| `seraph-death` | `seraph-death-sheet.png` | 4 | 4 | `death`: [0,1,2,3] @ 4fps, no-loop |

```typescript
export const SERAPH_STATE_TO_ANIMATION: Record<string, { sheetId: string; animName: string }> = {
  IDLE:                    { sheetId: "seraph-hover",   animName: "hover" },
  TELEPORT_OUT:            { sheetId: "seraph-hover",   animName: "hover" },
  TELEPORT_IN:             { sheetId: "seraph-hover",   animName: "hover" },
  BEAM_TELEGRAPH:          { sheetId: "seraph-cast",    animName: "cast-telegraph" },
  BEAM_FIRE:               { sheetId: "seraph-cast",    animName: "cast" },
  BEAM_COOLDOWN:           { sheetId: "seraph-hover",   animName: "hover" },
  BARRAGE_TELEGRAPH:       { sheetId: "seraph-cast",    animName: "cast-telegraph" },
  BARRAGE_FIRE:            { sheetId: "seraph-cast",    animName: "cast" },
  BARRAGE_STAGGER:         { sheetId: "seraph-stagger", animName: "stagger" },
  BARRAGE_RECOVER:         { sheetId: "seraph-hover",   animName: "hover" },
  DIVE_TELEGRAPH:          { sheetId: "seraph-dive",    animName: "dive-telegraph" },
  DIVE_ATTACK:             { sheetId: "seraph-dive",    animName: "dive" },
  DIVE_RECOVERY:           { sheetId: "seraph-stagger", animName: "stagger" },
  DIVE_ASCEND:             { sheetId: "seraph-hover",   animName: "hover" },
  RAPID_DIVE_INTER:        { sheetId: "seraph-hover",   animName: "hover" },
  STORM_TELEGRAPH:         { sheetId: "seraph-cast",    animName: "cast-telegraph" },
  STORM_FIRE:              { sheetId: "seraph-cast",    animName: "cast" },
  STORM_STAGGER:           { sheetId: "seraph-stagger", animName: "stagger" },
  STORM_RECOVER:           { sheetId: "seraph-hover",   animName: "hover" },
  TRIPLE_BEAM_TELEGRAPH:   { sheetId: "seraph-cast",    animName: "cast-telegraph" },
  TRIPLE_BEAM_FIRE:        { sheetId: "seraph-cast",    animName: "cast" },
  DESPERATION_TELEGRAPH:   { sheetId: "seraph-cast",    animName: "cast-telegraph" },
  DESPERATION_SLAM:        { sheetId: "seraph-dive",    animName: "dive" },
  DESPERATION_COLLAPSE:    { sheetId: "seraph-stagger", animName: "stagger" },
  DESPERATION_ASCEND:      { sheetId: "seraph-hover",   animName: "hover" },
  PHASE_TRANSITION:        { sheetId: "seraph-hover",   animName: "hover" },
  DYING:                   { sheetId: "seraph-death",   animName: "death" },
  DEAD:                    { sheetId: "seraph-death",   animName: "death" },
};
```

**Index Eater sprites** (128×96 frames — wide, ground-bound, segmented):

| Sheet ID | Filename | Frames | Cols | Animations |
|----------|----------|--------|------|------------|
| `eater-crawl` | `eater-crawl-sheet.png` | 4 | 4 | `crawl`: [0,1,2,3] @ 6fps, loop |
| `eater-lunge` | `eater-lunge-sheet.png` | 3 | 3 | `lunge-telegraph`: [0] @ 1fps, no-loop; `lunge`: [1,2] @ 12fps, no-loop |
| `eater-devour` | `eater-devour-sheet.png` | 4 | 4 | `devour-telegraph`: [0] @ 1fps, no-loop; `devour`: [1,2] @ 6fps, no-loop; `devour-stunned`: [3] @ 1fps, no-loop |
| `eater-spit` | `eater-spit-sheet.png` | 3 | 3 | `spit-telegraph`: [0] @ 1fps, no-loop; `spit`: [1,2] @ 8fps, no-loop |
| `eater-stunned` | `eater-stunned-sheet.png` | 2 | 2 | `stunned`: [0,1] @ 4fps, loop |
| `eater-death` | `eater-death-sheet.png` | 4 | 4 | `death`: [0,1,2,3] @ 4fps, no-loop |

```typescript
export const EATER_STATE_TO_ANIMATION: Record<string, { sheetId: string; animName: string }> = {
  IDLE:                    { sheetId: "eater-crawl",    animName: "crawl" },
  PATROL:                  { sheetId: "eater-crawl",    animName: "crawl" },
  CHASE:                   { sheetId: "eater-crawl",    animName: "crawl" },
  LUNGE_TELEGRAPH:         { sheetId: "eater-lunge",    animName: "lunge-telegraph" },
  LUNGE_ATTACK:            { sheetId: "eater-lunge",    animName: "lunge" },
  LUNGE_RECOVERY:          { sheetId: "eater-stunned",  animName: "stunned" },
  WHIP_TELEGRAPH:          { sheetId: "eater-crawl",    animName: "crawl" },
  WHIP_ATTACK:             { sheetId: "eater-crawl",    animName: "crawl" },
  WHIP_COOLDOWN:           { sheetId: "eater-crawl",    animName: "crawl" },
  SPIT_TELEGRAPH:          { sheetId: "eater-spit",     animName: "spit-telegraph" },
  SPIT_FIRE:               { sheetId: "eater-spit",     animName: "spit" },
  SPIT_COOLDOWN:           { sheetId: "eater-crawl",    animName: "crawl" },
  DEVOUR_TELEGRAPH:        { sheetId: "eater-devour",   animName: "devour-telegraph" },
  DEVOUR_EATING:           { sheetId: "eater-devour",   animName: "devour" },
  DEVOUR_STUNNED:          { sheetId: "eater-devour",   animName: "devour-stunned" },
  DEVOUR_RECOVER:          { sheetId: "eater-crawl",    animName: "crawl" },
  INK_FLOOD_TELEGRAPH:     { sheetId: "eater-crawl",    animName: "crawl" },
  INK_FLOOD_ACTIVE:        { sheetId: "eater-crawl",    animName: "crawl" },
  INK_FLOOD_COOLDOWN:      { sheetId: "eater-crawl",    animName: "crawl" },
  CLIMB_TO_WALL:           { sheetId: "eater-crawl",    animName: "crawl" },
  WALL_CRAWL:              { sheetId: "eater-crawl",    animName: "crawl" },
  CLIMB_TO_CEILING:        { sheetId: "eater-crawl",    animName: "crawl" },
  CEILING_CRAWL:           { sheetId: "eater-crawl",    animName: "crawl" },
  POUNCE_TELEGRAPH:        { sheetId: "eater-lunge",    animName: "lunge-telegraph" },
  POUNCE_ATTACK:           { sheetId: "eater-lunge",    animName: "lunge" },
  POUNCE_IMPACT:           { sheetId: "eater-lunge",    animName: "lunge" },
  POUNCE_STUNNED:          { sheetId: "eater-stunned",  animName: "stunned" },
  POUNCE_RECOVER:          { sheetId: "eater-crawl",    animName: "crawl" },
  CHAIN_STORM_TELEGRAPH:   { sheetId: "eater-crawl",    animName: "crawl" },
  CHAIN_STORM_ACTIVE:      { sheetId: "eater-crawl",    animName: "crawl" },
  CHAIN_STORM_COOLDOWN:    { sheetId: "eater-crawl",    animName: "crawl" },
  DEATH_THRASH_TELEGRAPH:  { sheetId: "eater-crawl",    animName: "crawl" },
  DEATH_THRASH_BOUNCE:     { sheetId: "eater-crawl",    animName: "crawl" },
  DEATH_THRASH_COLLAPSE:   { sheetId: "eater-stunned",  animName: "stunned" },
  DEATH_THRASH_RECOVER:    { sheetId: "eater-crawl",    animName: "crawl" },
  PHASE_TRANSITION:        { sheetId: "eater-crawl",    animName: "crawl" },
  DYING:                   { sheetId: "eater-death",    animName: "death" },
  DEAD:                    { sheetId: "eater-death",    animName: "death" },
};
```

**Helper exports** (same pattern as `EnemySprites.ts`):
```typescript
export function getBossSpriteConfigs(bossType: "footnote-giant" | "misprint-seraph" | "index-eater"): SpriteSheetConfig[]
export function getBossAnimations(bossType: "footnote-giant" | "misprint-seraph" | "index-eater"): Record<string, AnimationDef[]>
export function getBossStateToAnimation(bossType: "footnote-giant" | "misprint-seraph" | "index-eater"): Record<string, { sheetId: string; animName: string }>
```

### 2. Integrate Sprites into Footnote Giant

Modify `src/engine/entities/bosses/FootnoteGiant.ts`:

**Add fields:**
```typescript
private animControllers = new Map<string, AnimationController>();
private activeAnimController: AnimationController | null = null;
private spritesReady = false;
```

**Add `initSprites()` method** (call at end of constructor):
- Load all `GIANT_SPRITE_CONFIGS` via `AssetManager.getInstance().loadSpriteSheet()`
- Create `AnimationController` per sheet, register all animations
- Set `spritesReady = true` when all sheets are loaded

**Modify `update()` — add sprite animation update** after state machine update:
```typescript
// Sprite animation
const stateAnim = GIANT_STATE_TO_ANIMATION[this.stateMachine.currentState];
if (stateAnim && this.spritesReady) {
  const controller = this.animControllers.get(stateAnim.sheetId);
  if (controller) {
    if (this.activeAnimController !== controller) {
      this.activeAnimController = controller;
    }
    controller.play(stateAnim.animName);
    controller.update(dt);
  }
}
```

**Modify `render()` — dual-mode rendering:**

Replace the current sprite mode placeholder block (the simple colored rect + label) with actual sprite drawing:

```typescript
const mode = RenderConfig.getMode();

if (mode === "sprites" || mode === "both") {
  if (this.spritesReady && this.activeAnimController) {
    const sheet = this.activeAnimController.getSpriteSheet();
    if (sheet) {
      // Center sprite over boss position
      const spriteOffsetX = (sheet.config.frameWidth - this.size.x) / 2;
      const spriteOffsetY = (sheet.config.frameHeight - this.size.y);
      const drawX = this.position.x - spriteOffsetX;
      const drawY = this.position.y - spriteOffsetY;

      // Hit flash: draw white overlay
      if (this.hitFlashTimer > 0) {
        ctx.globalAlpha = 0.7;
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(drawX, drawY, sheet.config.frameWidth, sheet.config.frameHeight);
        ctx.globalAlpha = 1.0;
      }

      this.activeAnimController.draw(ctx, drawX, drawY, false);
    }
  } else {
    // Placeholder fallback
    ctx.fillStyle = this.hitFlashTimer > 0 ? "#ffffff" : "#4338ca";
    ctx.fillRect(this.position.x, this.position.y, this.size.x, this.size.y);
  }
}

if (mode === "rectangles" || mode === "both") {
  // Existing hand-crafted rectangle rendering stays exactly as-is
  // ... (all the bracket/glyph/bob drawing code)
}

// Telegraphs, projectiles, shockwaves, vulnerability label — ALWAYS drawn regardless of mode
// (these are not body rendering — they're gameplay-critical overlays)
```

**Key considerations for Footnote Giant:**
- Boss body is 128×160, sprite frames are 128×128 — sprite aligns bottom-edge with boss feet
- Footnote Giant is mostly stationary (fixed position), so no flipX needed
- Phase 3 visual changes (red tint, shake) should apply over sprites too — use `ctx.globalCompositeOperation = 'source-atop'` or tint overlay
- Death fade: apply `ctx.globalAlpha` reduction during DYING state before sprite draw

### 3. Integrate Sprites into Misprint Seraph

Modify `src/engine/entities/bosses/MisprintSeraph.ts`:

Same field/method additions as Footnote Giant, using `SERAPH_STATE_TO_ANIMATION` and `SERAPH_SPRITE_CONFIGS`.

**Special considerations:**
- Seraph teleports (TELEPORT_OUT/IN) — apply alpha fade to sprite (existing `teleportAlpha` field)
- Seraph hovers (position.y bobs via sin()) — sprite follows position, so hover is automatic
- Wing rendering in rectangles mode is complex geometry — in sprite mode, wings are part of the sprite sheet
- Phase 2/3 visual changes (red glow, corrupted wings): use a semi-transparent red overlay rect over the sprite when in later phases
- Stagger states use the `seraph-stagger` sheet — this replaces the circling punctuation marks in rectangle mode

**Teleport sprite handling:**
```typescript
// During TELEPORT_OUT / TELEPORT_IN, apply teleport alpha
if (this.stateMachine.currentState === "TELEPORT_OUT" ||
    this.stateMachine.currentState === "TELEPORT_IN") {
  ctx.globalAlpha = this.teleportAlpha;
}
// Draw sprite
this.activeAnimController.draw(ctx, drawX, drawY, false);
ctx.globalAlpha = 1.0;
```

### 4. Integrate Sprites into Index Eater

Modify `src/engine/entities/bosses/IndexEater.ts`:

Same field/method additions, using `EATER_STATE_TO_ANIMATION` and `EATER_SPRITE_CONFIGS`.

**Special considerations — this is the most complex:**
- Index Eater renders as **segmented body** in rectangles mode, but sprite mode shows it as a single entity. The sprite replaces the full segmented body rendering.
- Surface rotation: Index Eater crawls on walls/ceiling. Apply `ctx.rotate()` based on `currentSurface` before drawing sprite — same rotation logic as the rectangles rendering already uses.
- Index Eater is wider than tall (128×96 frames). Sprite offset: center horizontally, align bottom.
- Chain whip and tail paper scraps: these are attack effects, draw them ALWAYS (not mode-dependent).
- Destructible platform visuals, ink flood zones, card projectiles, shockwaves: all drawn regardless of mode.

**Surface rotation for sprite mode:**
```typescript
ctx.save();
ctx.translate(centerX, centerY);
ctx.rotate(this.bodyRotation); // Already computed based on currentSurface
const drawX = -sheet.config.frameWidth / 2;
const drawY = -sheet.config.frameHeight / 2;
this.activeAnimController.draw(ctx, drawX, drawY, false);
ctx.restore();
```

### 5. Update `scripts/generate-assets.ts`

Add prompts for all new boss sprite sheets. Use the established style prefix.

**Footnote Giant prompts (5 sheets):**

```typescript
// Category: bosses
{
  id: "giant-idle",
  filename: "giant-idle-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a massive towering footnote golem made of stacked books and parchment, 4 frames in a horizontal strip, idle breathing animation with pages rustling gently, heavy stone-like base, glowing arcane symbols on spine, each frame 128x128 pixels, indigo and gold tones, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
{
  id: "giant-stomp",
  filename: "giant-stomp-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a massive footnote golem stomping attack, 4 frames in a horizontal strip: telegraph pose with arm raised, downward slam impact, shockwave burst from ground, stuck in ground recovery, each frame 128x128 pixels, indigo and orange impact tones, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
{
  id: "giant-sweep",
  filename: "giant-sweep-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a massive footnote golem sweeping beam attack, 4 frames in a horizontal strip: telegraph pose with energy gathering, beam extending left, beam at full width, beam fading, each frame 128x128 pixels, indigo and red beam tones, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
{
  id: "giant-vulnerable",
  filename: "giant-vulnerable-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a massive footnote golem in a stunned vulnerable state, 2 frames in a horizontal strip: dazed wobble left, dazed wobble right, stars/symbols circling head, cracked pages falling, each frame 128x128 pixels, indigo with yellow vulnerability glow, game boss sprite sheet, 256x128 total`,
  aspectRatio: "16:9",
},
{
  id: "giant-death",
  filename: "giant-death-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a massive footnote golem collapsing and dying, 4 frames in a horizontal strip: cracking apart, tilting over, crumbling to pieces, scattered pages on ground, each frame 128x128 pixels, fading indigo tones, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
```

**Misprint Seraph prompts (5 sheets):**

```typescript
{
  id: "seraph-hover",
  filename: "seraph-hover-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of an angelic floating seraph creature made of misprinted pages with torn paper wings, 4 frames in a horizontal strip, hovering animation with wing flaps and floating page debris, ethereal white and red corruption tones, halo of punctuation marks, each frame 128x128 pixels, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
{
  id: "seraph-dive",
  filename: "seraph-dive-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a paper seraph diving downward in attack, 3 frames in a horizontal strip: wings tucked preparing to dive, mid-dive with wings swept back and speed lines, impact pose at bottom, each frame 128x128 pixels, white and red tones, game boss sprite sheet, 384x128 total`,
  aspectRatio: "16:9",
},
{
  id: "seraph-cast",
  filename: "seraph-cast-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a paper seraph casting a glyph spell, 4 frames in a horizontal strip: gathering energy with glowing hands, arms outstretched channeling, energy beams projecting from hands, spell release with page burst, each frame 128x128 pixels, white body with red energy tones, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
{
  id: "seraph-stagger",
  filename: "seraph-stagger-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a paper seraph in a stunned staggering state, 2 frames in a horizontal strip: wings drooping and body tilted left, wings drooping and body tilted right, pages falling from body, each frame 128x128 pixels, dimmed white tones, game boss sprite sheet, 256x128 total`,
  aspectRatio: "16:9",
},
{
  id: "seraph-death",
  filename: "seraph-death-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a paper seraph dissolving in death, 4 frames in a horizontal strip: wings crumpling, body splitting into pages, pages scattering outward, final wisps of paper dust, each frame 128x128 pixels, fading white tones, game boss sprite sheet, 512x128 total`,
  aspectRatio: "16:9",
},
```

**Index Eater prompts (6 sheets):**

```typescript
{
  id: "eater-crawl",
  filename: "eater-crawl-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a segmented centipede-like creature made of filing tabs and index cards, 4 frames in a horizontal strip, crawling animation with undulating body segments and many tab-legs, tan and dark brown tones, wide low creature, each frame 128x96 pixels, game boss sprite sheet, 512x96 total`,
  aspectRatio: "16:9",
},
{
  id: "eater-lunge",
  filename: "eater-lunge-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a filing-tab centipede lunging forward to attack, 3 frames in a horizontal strip: coiled back preparing to strike, mid-lunge with body extended and jaws open, full extension with mouth snapping, each frame 128x96 pixels, tan and red danger tones, game boss sprite sheet, 384x96 total`,
  aspectRatio: "16:9",
},
{
  id: "eater-devour",
  filename: "eater-devour-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a filing-tab centipede devouring a platform, 4 frames in a horizontal strip: mouth opening wide, chomping down on floor piece, chewing with debris, stunned and bloated from overeating, each frame 128x96 pixels, tan with dark ink stain tones, game boss sprite sheet, 512x96 total`,
  aspectRatio: "16:9",
},
{
  id: "eater-spit",
  filename: "eater-spit-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a filing-tab centipede spitting card projectiles, 3 frames in a horizontal strip: head rearing back, mouth opening with visible cards, cards launching outward in fan pattern, each frame 128x96 pixels, tan body with amber projectile tones, game boss sprite sheet, 384x96 total`,
  aspectRatio: "16:9",
},
{
  id: "eater-stunned",
  filename: "eater-stunned-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a filing-tab centipede in stunned vulnerable state, 2 frames in a horizontal strip: belly exposed and legs twitching left, belly exposed and legs twitching right, tabs splayed out weakly, each frame 128x96 pixels, pale tan vulnerability tones, game boss sprite sheet, 256x96 total`,
  aspectRatio: "16:9",
},
{
  id: "eater-death",
  filename: "eater-death-sheet.png",
  prompt: `${STYLE_PREFIX} sprite sheet of a filing-tab centipede dying and falling apart, 4 frames in a horizontal strip: body cracking, segments separating, tabs and cards scattering, pile of loose papers on ground, each frame 128x96 pixels, fading tan tones, game boss sprite sheet, 512x96 total`,
  aspectRatio: "16:9",
},
```

**Group these under a `"bosses"` category** for the `--category` CLI flag support (to be added in Task 11, but organize them now so the developer building the pipeline knows the grouping).

### 6. Update AssetManager Placeholder Colors

In `src/engine/core/AssetManager.ts`, the placeholder color detection currently checks for `player-` prefix (pink) and `tiles-` prefix (brown). Add a `boss` prefix check:

```typescript
// In createPlaceholder or loadSpriteSheet:
if (id.startsWith("giant-") || id.startsWith("seraph-") || id.startsWith("eater-")) {
  placeholderColor = "#8b5cf6"; // Purple for bosses
}
```

This matches the placeholder palette from the epic README: bosses = `#8b5cf6`.

## Files to Create/Modify

| File | Action |
|------|--------|
| `src/engine/entities/bosses/BossSprites.ts` | **Create** — sprite configs, animations, state mappings for all 3 bosses |
| `src/engine/entities/bosses/FootnoteGiant.ts` | **Modify** — add sprite fields, initSprites(), update animation, dual-mode render |
| `src/engine/entities/bosses/MisprintSeraph.ts` | **Modify** — add sprite fields, initSprites(), update animation, dual-mode render (with teleport alpha) |
| `src/engine/entities/bosses/IndexEater.ts` | **Modify** — add sprite fields, initSprites(), update animation, dual-mode render (with surface rotation) |
| `src/engine/core/AssetManager.ts` | **Modify** — add boss placeholder color detection (purple `#8b5cf6`) |
| `scripts/generate-assets.ts` | **Modify** — add 16 new boss sprite prompts |

## What NOT to Do

- Do NOT modify boss state machines or add new states — sprite integration is purely visual
- Do NOT touch the `RenderConfig` system (already complete)
- Do NOT generate actual image files — just define configs and prompts
- Do NOT remove or alter any existing rectangle-mode rendering — it must be pixel-identical to current behavior
- Do NOT modify boss test pages (`/test/boss/*`) — the existing RenderConfig toggle already works and will pick up the new sprites automatically
- Do NOT add sprite rendering for attack telegraphs, projectiles, or shockwaves — those stay as canvas primitives in all modes (they're gameplay-critical overlays, not body rendering)
- Do NOT create a boss base class or refactor inheritance — each boss manages its own sprites directly (same pattern as Player.ts)

## Verification / Pass Criteria

1. **TypeScript compiles**: `npx tsc --noEmit` passes with no errors
2. **All boss states mapped**: Every state in each boss's state machine has an entry in its `STATE_TO_ANIMATION` mapping
3. **16 sprite sheet configs total**: 5 (Giant) + 5 (Seraph) + 6 (Eater) = 16
4. **Frame counts match**: Each config's `totalFrames` matches the number of frames in its animations
5. **Existing tests pass**: `npm run test:run` still passes — headless tests don't load sprites
6. **Placeholder rendering**: When running the dev server:
   - `/test/boss/footnote-giant` in "sprites" mode shows purple placeholder rectangles
   - `/test/boss/misprint-seraph` in "sprites" mode shows purple placeholder rectangles (with teleport fade working)
   - `/test/boss/index-eater` in "sprites" mode shows purple placeholder rectangles (with surface rotation working)
7. **Rectangle mode unchanged**: Switching to "rectangles" mode produces the exact same visuals as before this change
8. **Vulnerability visual**: Boss vulnerable states (PILLAR_STUCK, BARRAGE_STAGGER, etc.) use the dedicated vulnerable/stagger sprite animations
9. **Death animation**: Boss death states play the death sprite animation
10. **Generate script prompts**: The script's asset prompts array includes all 16 new boss prompts
11. **Both mode works**: In "both" mode, sprite renders first, then semi-transparent rectangle rendering overlays on top
12. **No console errors**: Sprite loading failures are handled silently by AssetManager placeholder system

---

## Completion Summary

**Status:** Done
**Date:** 2026-02-25

### Files Created
- `src/engine/entities/bosses/BossSprites.ts` — Central file with all boss sprite configs, animations, and state→animation mappings for 3 bosses (16 sprite sheet configs total: 5 Giant + 5 Seraph + 6 Eater)

### Files Modified
- `src/engine/entities/bosses/FootnoteGiant.ts` — Added AnimationController integration, initSprites(), sprite animation update in update(), dual-mode rendering with hit flash and Phase 3 red tint overlays
- `src/engine/entities/bosses/MisprintSeraph.ts` — Same sprite integration with teleportAlpha applied to sprites, Phase 2/3 red glow overlay, wing/body/glyph/halo wrapped in rectangle mode check
- `src/engine/entities/bosses/IndexEater.ts` — Same sprite integration with flipX based on facingRight, surface rotation (bodyRotation) applied before sprite draw, segmented body rendering wrapped in rectangle mode check
- `src/engine/core/AssetManager.ts` — Added boss placeholder color prefixes (giant, seraph, eater → #8b5cf6 purple)
- `scripts/generate-assets.ts` — Added 16 boss sprite generation prompts (5 Giant, 5 Seraph, 6 Eater)

### Verification
- `npx tsc --noEmit` — passes with no errors
- `npm run test:run` — all 427 tests pass
- All boss states mapped to sprite animations
- Attack telegraphs, projectiles, shockwaves, and vulnerability indicators remain drawn as canvas primitives in all render modes

---

## Review Notes (2026-02-25)

**Reviewer:** Swarm Reviewer Agent

### Issues Found and Fixed

1. **Hit flash rendering order (all 3 bosses)** — The white hit flash overlay was drawn _before_ the sprite, causing the sprite to be drawn on top and hiding the flash entirely. Fixed in FootnoteGiant.ts, MisprintSeraph.ts, and IndexEater.ts by moving the flash draw call to _after_ `activeAnimController.draw()`. This ensures the white flash is visible on top of the sprite body.

2. **IndexEater placeholder fallback color** — The placeholder fallback rectangle in IndexEater's sprite render block used `#365314` (dark green) instead of the standard boss purple `#8b5cf6`. Fixed to match the AssetManager placeholder color convention.

### Verified Correct

- **BossSprites.ts**: All 82 boss states across 3 bosses have complete animation mappings (16 Giant + 28 Seraph + 38 Eater). No missing or extra entries.
- **16 sprite sheet configs**: 5 Giant + 5 Seraph + 6 Eater, frame counts match animation defs.
- **AssetManager.ts**: Boss placeholder colors correctly registered (giant, seraph, eater → #8b5cf6).
- **generate-assets.ts**: All 16 boss sprite prompts added with correct IDs, filenames, and style prefix.
- **Dual-mode rendering**: All 3 bosses correctly check `RenderConfig.getMode()` and wrap rectangle rendering appropriately. "both" mode applies 0.5 alpha to rectangles.
- **Teleport alpha**: MisprintSeraph correctly applies `teleportAlpha` to sprite rendering via `ctx.globalAlpha`.
- **Surface rotation**: IndexEater correctly applies `bodyRotation` via `ctx.translate`/`ctx.rotate` before sprite draw.
- **FlipX**: IndexEater uses `!this.facingRight` correctly (sprites are drawn facing right by default).
- **Death fade**: All bosses correctly apply death alpha to sprites.
- **No state machine changes**: Sprite integration is purely visual — no state additions or behavior changes.
- **No memory leaks**: Sprite loading is fire-and-forget via AssetManager singleton cache, no cleanup needed.
- **TypeScript**: Clean compile, no `any` types.
- **Tests**: All 427 tests pass after fixes.
